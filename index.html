<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/><title>Market Overbought/Oversold Dashboard</title><style>:root{--bg:#0f1115;--card:#171923;--muted:#8a94a6;--text:#e6e9ef;--accent:#66c3ff;--red:#ff6b6b;--green:#27d980;--amber:#ffcf5c;--neutral:#2a2f3a;--chip:#212633;--chip-border:#2d3445}*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji,Noto Color Emoji;background:linear-gradient(180deg,#0e1014 0%,#0f1115 100%);color:var(--text)}header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(10px);background:rgba(15,17,21,.7);border-bottom:1px solid #1f2330}.wrap{max-width:1200px;margin:0 auto;padding:18px 20px}h1{font-size:20px;margin:0 0 6px;letter-spacing:.5px}.sub{color:var(--muted);font-size:13px}.controls{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}.btn{background:var(--chip);border:1px solid var(--chip-border);color:var(--text);padding:9px 12px;border-radius:9px;cursor:pointer;font-weight:600;font-size:14px}.btn:hover{border-color:#3c4560}input,select{background:#0f131d;color:var(--text);border:1px solid #2b3346;padding:10px 12px;border-radius:9px;outline:none;font-size:14px}.pill{padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;display:inline-flex;align-items:center;gap:6px}.pill.ob{background:rgba(255,107,107,.12);border:1px solid rgba(255,107,107,.3);color:#ffb3b3}.pill.os{background:rgba(39,217,128,.12);border:1px solid rgba(39,217,128,.3);color:#a9f5cd}.pill.neutral{background:rgba(255,207,92,.08);border:1px solid rgba(255,207,92,.25);color:#ffe3a4}.grid{padding:16px 20px}table{width:100%;border-collapse:separate;border-spacing:0 10px}thead th{text-align:left;font-size:12px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.6px;padding:0 10px}tbody td{background:var(--card);border-top:1px solid #232836;border-bottom:1px solid #232836;padding:12px 10px;vertical-align:middle}tbody tr td:first-child{border-left:1px solid #232836;border-top-left-radius:12px;border-bottom-left-radius:12px}tbody tr td:last-child{border-right:1px solid #232836;border-top-right-radius:12px;border-bottom-right-radius:12px}.asset{display:flex;flex-direction:column;gap:4px}.asset .sym{font-weight:800;letter-spacing:.3px;font-size:14px}.asset .name{font-size:12px;color:var(--muted)}.num{font-variant-numeric:tabular-nums;white-space:nowrap}.neg{color:var(--red)}.pos{color:var(--green)}canvas.spark{width:140px;height:36px}.chiplist{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}.chip{background:var(--chip);border:1px solid var(--chip-border);padding:6px 9px;border-radius:999px;font-size:12px;font-weight:700;letter-spacing:.3px;cursor:default}footer{color:var(--muted);font-size:12px;padding:16px 20px 40px;text-align:center}.hint{color:var(--muted);font-size:12px}.loader{display:none}.loader.on{display:inline-block}.state-cell{min-width:120px}.spark-cell{min-width:160px}.sticky-tools{position:fixed;right:16px;bottom:16px;display:flex;gap:10px;flex-direction:column}.floating{background:var(--card);border:1px solid #2c3244;border-radius:12px;padding:10px 12px;font-size:13px;color:var(--muted)}</style></head><body><header><div class='wrap'><h1>Market Overbought/Oversold Dashboard</h1><div class='sub'>Tracks RSI, Stoch %K, Williams %R, Bollinger %B, and distance from 200‑DMA across key U.S. indices, bonds, crypto, and commodities. <span id='lastUpdated'></span></div><div class='controls'><button class='btn' id='refreshBtn'>Refresh Now <span class='loader' id='loader'>⏳</span></button><label class='hint'>Auto-refresh <select id='autoSel'><option value='0'>Off</option><option value='5'>Every 5 minutes</option><option value='10'>Every 10 minutes</option><option value='30'>Every 30 minutes</option><option value='60'>Every 60 minutes</option></select></label><button class='btn' id='exportBtn'>Export CSV</button><span class='hint'>Tip: Click a symbol to open Yahoo Finance.</span></div><div class='chiplist' id='universeChips'></div><div class='controls' style='margin-top:10px'><input id='addSym' placeholder='Add symbol (e.g., SPY or BTC-USD or CL=F)' /><input id='addName' placeholder='Label (optional)' /><button class='btn' id='addBtn'>Add</button><button class='btn' id='resetBtn' title='Restore defaults'>Reset to Defaults</button></div></div></header><main class='wrap grid'><table id='tbl'><thead><tr><th>Asset</th><th>Ticker</th><th>Price</th><th>RSI(14)</th><th>Stoch %K(14)</th><th>Williams %R(14)</th><th>%B (20, 2σ)</th><th>Dist 200‑DMA</th><th>Score</th><th class='state-cell'>State</th><th class='spark-cell'>Trend (1Y)</th></tr></thead><tbody id='tbody'></tbody></table></main><div class='sticky-tools'><div class='floating'>Overbought: RSI&gt;70, %K&gt;80, %R&gt;-20, %B&gt;1, Dist200&gt;+10%<br>Oversold: RSI&lt;30, %K&lt;20, %R&lt;-80, %B&lt;0, Dist200&lt;-10%</div></div><footer>Data: Yahoo Finance (chart API). Indicators computed client‑side. Informational only, not investment advice.</footer><script>(()=>{const DEFAULT_UNIVERSE=[{name:"US Stock – S&P 500",sym:"SPY"},{name:"US Stock – Nasdaq 100",sym:"QQQ"},{name:"US Total Market",sym:"VTI"},{name:"US Bonds – Long Treasuries",sym:"TLT"},{name:"US Bonds – Aggregate",sym:"BND"},{name:"High Yield Bonds",sym:"JNK"},{name:"Real Estate (US REITs)",sym:"VNQ"},{name:"US Dollar Index (ETF)",sym:"UUP"},{name:"Bitcoin",sym:"BTC-USD"},{name:"Ethereum",sym:"ETH-USD"},{name:"WTI Crude Oil",sym:"CL=F"},{name:"Brent Crude Oil",sym:"BZ=F"},{name:"Gold",sym:"GC=F"},{name:"Silver",sym:"SI=F"},{name:"Copper",sym:"HG=F"},{name:"Natural Gas",sym:"NG=F"},{name:"Corn",sym:"ZC=F"},{name:"Wheat",sym:"ZW=F"}];const STORAGE_KEY="market_oo_universe_v1";function loadUniverse(){try{const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return DEFAULT_UNIVERSE.slice();const parsed=JSON.parse(raw);if(!Array.isArray(parsed)||parsed.length===0)return DEFAULT_UNIVERSE.slice();return parsed}catch(e){return DEFAULT_UNIVERSE.slice()}}function saveUniverse(u){localStorage.setItem(STORAGE_KEY,JSON.stringify(u))}let UNIVERSE=loadUniverse();async function fetchYahooChart(sym,range="2y",interval="1d"){const url=`https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(sym)}?range=${range}&interval=${interval}`;const res=await fetch(url,{cache:"no-store"});if(!res.ok)throw new Error(`HTTP ${res.status}`);const j=await res.json();if(!j||!j.chart||!j.chart.result||!j.chart.result[0])throw new Error("No result");const r=j.chart.result[0];const ind=r.indicators||{};const ohlc=ind.quote&&ind.quote[0]?ind.quote[0]:{};const closes=(ohlc.close||[]).map(x=>x==null?NaN:Number(x));const highs=(ohlc.high||[]).map(x=>x==null?NaN:Number(x));const lows=(ohlc.low||[]).map(x=>x==null?NaN:Number(x));const price=(r.meta&&(r.meta.regularMarketPrice??r.meta.previousClose))??(closes.length?closes[closes.length-1]:NaN);return{closes,highs,lows,price}}function sma(arr,period){if(arr.length<period)return NaN;let s=0;for(let i=arr.length-period;i<arr.length;i++)s+=arr[i];return s/period}function stddev(arr,period){if(arr.length<period)return NaN;const m=sma(arr,period);let s=0;for(let i=arr.length-period;i<arr.length;i++){const d=arr[i]-m;s+=d*d}return Math.sqrt(s/period)}function rsi(closes,period=14){if(closes.length<=period)return NaN;let gains=0,losses=0;for(let i=1;i<=period;i++){const d=closes[i]-closes[i-1];if(d>=0)gains+=d;else losses-=d}let ag=gains/period,al=losses/period;for(let i=period+1;i<closes.length;i++){const d=closes[i]-closes[i-1];const g=Math.max(d,0),l=Math.max(-d,0);ag=(ag*(period-1)+g)/period;al=(al*(period-1)+l)/period}if(al===0)return 100;const rs=ag/al;return 100-(100/(1+rs))}function rollingHigh(arr,period){if(arr.length<period)return NaN;let h=-Infinity;for(let i=arr.length-period;i<arr.length;i++)if(arr[i]>h)h=arr[i];return h}function rollingLow(arr,period){if(arr.length<period)return NaN;let l=Infinity;for(let i=arr.length-period;i<arr.length;i++)if(arr[i]<l)l=arr[i];return l}function stochasticK(highs,lows,closes,kPeriod=14){if(highs.length<kPeriod||lows.length<kPeriod||closes.length<kPeriod)return NaN;const hh=rollingHigh(highs,kPeriod);const ll=rollingLow(lows,kPeriod);return(closes[closes.length-1]-ll)/(hh-ll)*100}function williamsR(highs,lows,closes,period=14){if(highs.length<period||lows.length<period||closes.length<period)return NaN;const hh=rollingHigh(highs,period);const ll=rollingLow(lows,period);return-100*(hh-closes[closes.length-1])/(hh-ll)}function percentB(closes,period=20,mult=2){if(closes.length<period)return NaN;const m=sma(closes,period),sd=stddev(closes,period);if(!isFinite(m)||!isFinite(sd)||sd===0)return NaN;const upper=m+mult*sd,lower=m-mult*sd,last=closes[closes.length-1];return(last-lower)/(upper-lower)}function distanceFromSMA(closes,period=200){if(closes.length<period)return NaN;const m=sma(closes,period);const last=closes[closes.length-1];return last/m-1}function compositeScore({rsiVal,stochKVal,willRVal,pctBVal,dist200Val}){let s=0;if(isFinite(rsiVal))s+=rsiVal>70?1:rsiVal<30?-1:0;if(isFinite(stochKVal))s+=stochKVal>80?1:stochKVal<20?-1:0;if(isFinite(willRVal))s+=willRVal>-20?1:willRVal<-80?-1:0;if(isFinite(pctBVal))s+=pctBVal>1?1:pctBVal<0?-1:0;if(isFinite(dist200Val))s+=dist200Val>0.1?1:dist200Val<-0.1?-1:0;return s}function stateFromScore(s){if(s>=3)return{label:"Overbought",cls:"ob"};if(s<=-3)return{label:"Oversold",cls:"os"};return{label:"Neutral",cls:"neutral"}}function fmtPct(x,d=1){return isFinite(x)?(x*100).toFixed(d)+"%":"—"}function fmtNum(x,d=2){return isFinite(x)?Number(x).toFixed(d):"—"}const tbody=document.getElementById('tbody');const chips=document.getElementById('universeChips');const lastUpdated=document.getElementById('lastUpdated');const loader=document.getElementById('loader');function renderChips(){chips.innerHTML='';UNIVERSE.forEach((u,idx)=>{const span=document.createElement('span');span.className='chip';span.textContent=`${u.name||u.sym} • ${u.sym}`;span.title='Click to remove';span.style.cursor='pointer';span.addEventListener('click',()=>{UNIVERSE.splice(idx,1);saveUniverse(UNIVERSE);refresh()});chips.appendChild(span)})}function sparkline(canvas,series){const ctx=canvas.getContext('2d');const w=canvas.width,h=canvas.height;ctx.clearRect(0,0,w,h);if(!series||series.length<2)return;const finite=series.filter(Number.isFinite);const min=Math.min(...finite);const max=Math.max(...finite);const pad=3;const n=series.length;ctx.beginPath();for(let i=0;i<n;i++){const v=series[i];if(!isFinite(v))continue;const x=pad+(w-2*pad)*i/(n-1);const y=pad+(h-2*pad)*(1-(v-min)/(max-min));if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)}ctx.lineWidth=1.7;ctx.strokeStyle='#66c3ff';ctx.stroke();for(let i=n-1;i>=0;i--){const v=series[i];if(!isFinite(v))continue;const x=pad+(w-2*pad)*i/(n-1);const y=pad+(h-2*pad)*(1-(v-min)/(max-min));ctx.beginPath();ctx.arc(x,y,2.5,0,Math.PI*2);ctx.fillStyle='#66c3ff';ctx.fill();break}}function linkToYahoo(sym){return 'https://finance.yahoo.com/quote/'+encodeURIComponent(sym)}async function rowForAsset(asset){const tr=document.createElement('tr');const tds=new Array(11).fill(0).map(()=>document.createElement('td'));tds.forEach(td=>tr.appendChild(td));tds[0].innerHTML=`<div class="asset"><div class="sym">${asset.sym}</div><div class="name">${asset.name||''}</div></div>`;tds[1].innerHTML=`<a href="${linkToYahoo(asset.sym)}" target="_blank" rel="noopener noreferrer">${asset.sym}</a>`;try{const{closes,highs,lows,price}=await fetchYahooChart(asset.sym,'2y','1d');function lastNValid(arr,n){const out=[];for(let i=arr.length-1;i>=0&&out.length<n;i--){const v=arr[i];if(isFinite(v))out.unshift(v)}return out}const c=lastNValid(closes,260);const h=lastNValid(highs,260);const l=lastNValid(lows,260);const rsiVal=rsi(c,14);const stochKVal=stochasticK(h,l,c,14);const willRVal=williamsR(h,l,c,14);const pctBVal=percentB(c,20,2);const dist200Val=distanceFromSMA(c,200);const score=compositeScore({rsiVal,stochKVal,willRVal,pctBVal,dist200Val});const state=stateFromScore(score);tds[2].innerHTML=`<span class="num">${fmtNum(price)}</span>`;tds[3].innerHTML=`<span class="num ${rsiVal>=70?'pos':''} ${rsiVal<=30?'neg':''}">${fmtNum(rsiVal)}</span>`;tds[4].innerHTML=`<span class="num ${stochKVal>=80?'pos':''} ${stochKVal<=20?'neg':''}">${fmtNum(stochKVal)}</span>`;tds[5].innerHTML=`<span class="num ${willRVal>-20?'pos':''} ${willRVal<-80?'neg':''}">${fmtNum(willRVal)}</span>`;tds[6].innerHTML=`<span class="num ${pctBVal>1?'pos':''} ${pctBVal<0?'neg':''}">${fmtNum(pctBVal,2)}</span>`;tds[7].innerHTML=`<span class="num ${dist200Val>0.10?'pos':''} ${dist200Val<-0.10?'neg':''}">${fmtPct(dist200Val,1)}</span>`;tds[8].innerHTML=`<b class="num">${score}</b>`;tds[9].innerHTML=`<span class="pill ${state.cls}">${state.label}</span>`;const spark=document.createElement('canvas');spark.className='spark';spark.width=280;spark.height=72;tds[10].appendChild(spark);const last252=lastNValid(closes,252);sparkline(spark,last252)}catch(e){tds[2].textContent='—';tds[3].textContent='—';tds[4].textContent='—';tds[5].textContent='—';tds[6].textContent='—';tds[7].textContent='—';tds[8].textContent='—';tds[9].innerHTML=`<span class="pill neutral">No data</span>`;tds[10].textContent='—';tr.title=String(e)}return tr}async function refresh(){loader.classList.add('on');tbody.innerHTML='';renderChips();const rows=await Promise.all(UNIVERSE.map(u=>rowForAsset(u)));rows.sort((a,b)=>{const ax=parseFloat(a.children[8].textContent)||-Infinity;const bx=parseFloat(b.children[8].textContent)||-Infinity;return(isNaN(bx)?-999:bx)-(isNaN(ax)?-999:ax)});rows.forEach(r=>tbody.appendChild(r));const now=new Date();lastUpdated.textContent=`• Last updated ${now.toLocaleString()}`;loader.classList.remove('on')}function exportCSV(){const headers=['Asset','Ticker','Price','RSI(14)','Stoch%K(14)','Williams%R(14)','%B(20,2σ)','Dist200DMA','Score','State'];const lines=[headers.join(',')];[...tbody.children].forEach(tr=>{const tds=[...tr.children];const asset=tds[0].querySelector('.name')?.textContent||'';const sym=tds[1].innerText.trim();const getNum=td=>td.querySelector('.num')?.textContent??td.textContent.trim();const price=getNum(tds[2]);const rsi=getNum(tds[3]);const stoch=getNum(tds[4]);const willr=getNum(tds[5]);const pb=getNum(tds[6]);const dist=getNum(tds[7]);const score=tds[8].innerText.trim();const state=tds[9].innerText.trim();const row=[safe(asset),safe(sym),safe(price),safe(rsi),safe(stoch),safe(willr),safe(pb),safe(dist),safe(score),safe(state)];lines.push(row.join(','))});const blob=new Blob([lines.join('\n')],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='market_overbought_oversold.csv';document.body.appendChild(a);a.click();a.remove()}function safe(s){if(s==null)return'';s=String(s);if(s.includes(',')||s.includes('"'))return '"'+s.replace(/"/g,'""')+'"';return s}document.getElementById('refreshBtn').addEventListener('click',refresh);document.getElementById('exportBtn').addEventListener('click',exportCSV);document.getElementById('addBtn').addEventListener('click',()=>{const sym=document.getElementById('addSym').value.trim();const name=document.getElementById('addName').value.trim();if(!sym)return;if(UNIVERSE.some(u=>u.sym.toUpperCase()===sym.toUpperCase())){alert('That symbol is already in the list.');return}UNIVERSE.push({name:name||sym,sym});saveUniverse(UNIVERSE);document.getElementById('addSym').value='';document.getElementById('addName').value='';refresh()});document.getElementById('resetBtn').addEventListener('click',()=>{if(confirm('Restore default asset list?')){UNIVERSE=DEFAULT_UNIVERSE.slice();saveUniverse(UNIVERSE);refresh()}});const autoSel=document.getElementById('autoSel');const AUTO_KEY='market_oo_autorefresh_minutes';function loadAuto(){const v=localStorage.getItem(AUTO_KEY);if(v){autoSel.value=v}}function saveAuto(v){localStorage.setItem(AUTO_KEY,v)}let timer=null;function setupTimer(){if(timer)clearInterval(timer);const mins=parseInt(autoSel.value,10);if(mins>0){timer=setInterval(refresh,mins*60*1000)}}autoSel.addEventListener('change',()=>{saveAuto(autoSel.value);setupTimer()});loadAuto();setupTimer();renderChips();refresh();})();</script></body></html>